<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>module Bio::FlatFileIndex::Indexer - BioRuby API documentation</title>

  <meta name="keywords" content="ruby,module,Bio::FlatFileIndex::Indexer">

    <meta name="description" content="Documentation for the Bio::FlatFileIndex::Indexer module">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="module">
<div id="navigation-toggle" role="button" tabindex="0" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="navigation">
  <span aria-hidden="true">&#9776;</span>
</div>


<nav id="navigation" role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search (/) for a class, method, ..." spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
  
  
  
  
  
  <div class="nav-section">
    <h3>Class Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-c-addindex_bdb">addindex_bdb</a></li>
      <li ><a href="#method-c-addindex_flat">addindex_flat</a></li>
      <li ><a href="#method-c-chose_sort_proc">chose_sort_proc</a></li>
      <li ><a href="#method-c-makeindexBDB">makeindexBDB</a></li>
      <li ><a href="#method-c-makeindexFlat">makeindexFlat</a></li>
      <li ><a href="#method-c-update_index">update_index</a></li>
    </ul>
  </div>





  <footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.10.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

</nav>

<main role="main" aria-labelledby="module-Bio::FlatFileIndex::Indexer">
  <h1 id="module-Bio::FlatFileIndex::Indexer" class="anchor-link module">
    module Bio::FlatFileIndex::Indexer
  </h1>

  <section class="description">
    
  </section>

  <section id="5Buntitled-5D" class="documentation-section anchor-link">


    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
        <dt id="DEFAULT_ENV">DEFAULT_ENV
        <dd>
          <p>default env program (run a program in a modified environment)</p>
        <dt id="DEFAULT_ENV_ARGS">DEFAULT_ENV_ARGS
        <dd>
          <p>default arguments for env program</p>
        <dt id="DEFAULT_SORT">DEFAULT_SORT
        <dd>
          <p>default sort program</p>
      </dl>
    </section>



     <section id="public-class-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-addindex_bdb" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-addindex_bdb" title="Link to this method">
                <span class="method-name">addindex_bdb</span>
                <span class="method-args">(db, flag, need_update, parser, options)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="addindex_bdb-source">
            <pre>    <span class="ruby-comment"># File lib/bio/io/flatfile/indexer.rb</span>
<span class="line-num">476</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">addindex_bdb</span>(<span class="ruby-identifier">db</span>, <span class="ruby-identifier">flag</span>, <span class="ruby-identifier">need_update</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">477</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;reading files...\n&quot;</span>
<span class="line-num">478</span> 
<span class="line-num">479</span>   <span class="ruby-identifier">pn</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">primary</span>
<span class="line-num">480</span>   <span class="ruby-identifier">pn</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">close</span>
<span class="line-num">481</span>   <span class="ruby-identifier">pn</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">flag</span> = <span class="ruby-identifier">flag</span>
<span class="line-num">482</span> 
<span class="line-num">483</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">secondary</span>.<span class="ruby-identifier">each_files</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
<span class="line-num">484</span>     <span class="ruby-identifier">x</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">close</span>
<span class="line-num">485</span>     <span class="ruby-identifier">x</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">flag</span> = <span class="ruby-identifier">flag</span>
<span class="line-num">486</span>     <span class="ruby-identifier">x</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">open</span>
<span class="line-num">487</span>     <span class="ruby-identifier">x</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">close</span>
<span class="line-num">488</span>   <span class="ruby-keyword">end</span>
<span class="line-num">489</span> 
<span class="line-num">490</span>   <span class="ruby-identifier">need_update</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fileid</span><span class="ruby-operator">|</span>
<span class="line-num">491</span>     <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>[<span class="ruby-identifier">fileid</span>].<span class="ruby-identifier">filename</span>
<span class="line-num">492</span>     <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">open_flatfile</span>(<span class="ruby-identifier">fileid</span>, <span class="ruby-identifier">filename</span>)
<span class="line-num">493</span>     <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pos</span>, <span class="ruby-identifier">len</span><span class="ruby-operator">|</span>
<span class="line-num">494</span>       <span class="ruby-identifier">p</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">parse_primary</span>
<span class="line-num">495</span>       <span class="ruby-comment">#pn.file.add_exclusive(p, [ fileid, pos, len ])</span>
<span class="line-num">496</span>       <span class="ruby-identifier">pn</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">add_overwrite</span>(<span class="ruby-identifier">p</span>, [ <span class="ruby-identifier">fileid</span>, <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">len</span> ])
<span class="line-num">497</span>       <span class="ruby-comment">#DEBUG.print &quot;#{p} #{fileid} #{pos} #{len}\n&quot;</span>
<span class="line-num">498</span>       <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">parse_secondary</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sn</span>, <span class="ruby-identifier">sp</span><span class="ruby-operator">|</span>
<span class="line-num">499</span>         <span class="ruby-identifier">db</span>.<span class="ruby-identifier">secondary</span>[<span class="ruby-identifier">sn</span>].<span class="ruby-identifier">file</span>.<span class="ruby-identifier">add_nr</span>(<span class="ruby-identifier">sp</span>, <span class="ruby-identifier">p</span>)
<span class="line-num">500</span>         <span class="ruby-comment">#DEBUG.print &quot;#{sp} #{p}\n&quot;</span>
<span class="line-num">501</span>       <span class="ruby-keyword">end</span>
<span class="line-num">502</span>     <span class="ruby-keyword">end</span>
<span class="line-num">503</span>     <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">close_flatfile</span>
<span class="line-num">504</span>   <span class="ruby-keyword">end</span>
<span class="line-num">505</span>   <span class="ruby-keyword">true</span>
<span class="line-num">506</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-c-addindex_flat" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-addindex_flat" title="Link to this method">
                <span class="method-name">addindex_flat</span>
                <span class="method-args">(db, mode, need_update, parser, options)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="addindex_flat-source">
            <pre>    <span class="ruby-comment"># File lib/bio/io/flatfile/indexer.rb</span>
<span class="line-num">525</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">addindex_flat</span>(<span class="ruby-identifier">db</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">need_update</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">526</span>   <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;tempfile&#39;</span>
<span class="line-num">527</span>   <span class="ruby-identifier">prog</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">&#39;sort_program&#39;</span>]
<span class="line-num">528</span>   <span class="ruby-identifier">env</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">&#39;env_program&#39;</span>]
<span class="line-num">529</span>   <span class="ruby-identifier">env_args</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">&#39;env_program_arguments&#39;</span>]
<span class="line-num">530</span> 
<span class="line-num">531</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">need_update</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
<span class="line-num">532</span> 
<span class="line-num">533</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;prepare temporary files...\n&quot;</span>
<span class="line-num">534</span>   <span class="ruby-identifier">tempbase</span> = <span class="ruby-node">&quot;bioflat#{rand(10000)}-&quot;</span>
<span class="line-num">535</span>   <span class="ruby-identifier">pfile</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">tempbase</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;primary-&#39;</span>)
<span class="line-num">536</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;open temporary file #{pfile.path.inspect}\n&quot;</span>
<span class="line-num">537</span>   <span class="ruby-identifier">sfiles</span> = {}
<span class="line-num">538</span>   <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">secondary</span>.<span class="ruby-identifier">names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
<span class="line-num">539</span>     <span class="ruby-identifier">sfiles</span>[<span class="ruby-identifier">x</span>] =  <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">tempbase</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;secondary-&#39;</span>)
<span class="line-num">540</span>     <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;open temporary file #{sfiles[x].path.inspect}\n&quot;</span>
<span class="line-num">541</span>   <span class="ruby-keyword">end</span>
<span class="line-num">542</span> 
<span class="line-num">543</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;reading files...\n&quot;</span>
<span class="line-num">544</span>   <span class="ruby-identifier">need_update</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fileid</span><span class="ruby-operator">|</span>
<span class="line-num">545</span>     <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>[<span class="ruby-identifier">fileid</span>].<span class="ruby-identifier">filename</span>
<span class="line-num">546</span>     <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">open_flatfile</span>(<span class="ruby-identifier">fileid</span>, <span class="ruby-identifier">filename</span>)
<span class="line-num">547</span>     <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pos</span>, <span class="ruby-identifier">len</span><span class="ruby-operator">|</span>
<span class="line-num">548</span>       <span class="ruby-identifier">p</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">parse_primary</span>
<span class="line-num">549</span>       <span class="ruby-identifier">pfile</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{p}\t#{fileid}\t#{pos}\t#{len}\n&quot;</span>
<span class="line-num">550</span>       <span class="ruby-comment">#DEBUG.print &quot;#{p} #{fileid} #{pos} #{len}\n&quot;</span>
<span class="line-num">551</span>       <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">parse_secondary</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sn</span>, <span class="ruby-identifier">sp</span><span class="ruby-operator">|</span>
<span class="line-num">552</span>         <span class="ruby-identifier">sfiles</span>[<span class="ruby-identifier">sn</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{sp}\t#{p}\n&quot;</span>
<span class="line-num">553</span>         <span class="ruby-comment">#DEBUG.print &quot;#{sp} #{p}\n&quot;</span>
<span class="line-num">554</span>       <span class="ruby-keyword">end</span>
<span class="line-num">555</span>     <span class="ruby-keyword">end</span>
<span class="line-num">556</span>     <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">close_flatfile</span>
<span class="line-num">557</span>     <span class="ruby-identifier">fileid</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
<span class="line-num">558</span>   <span class="ruby-keyword">end</span>
<span class="line-num">559</span> 
<span class="line-num">560</span>   <span class="ruby-identifier">sort_proc</span> = <span class="ruby-identifier">chose_sort_proc</span>(<span class="ruby-identifier">prog</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">env</span>, <span class="ruby-identifier">env_args</span>)
<span class="line-num">561</span>   <span class="ruby-identifier">pfile</span>.<span class="ruby-identifier">close</span>(<span class="ruby-keyword">false</span>)
<span class="line-num">562</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;sorting primary (#{parser.primary.name})...\n&quot;</span>
<span class="line-num">563</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">primary</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">import_tsv_files</span>(<span class="ruby-keyword">true</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">sort_proc</span>, <span class="ruby-identifier">pfile</span>.<span class="ruby-identifier">path</span>)
<span class="line-num">564</span>   <span class="ruby-identifier">pfile</span>.<span class="ruby-identifier">close</span>(<span class="ruby-keyword">true</span>)
<span class="line-num">565</span> 
<span class="line-num">566</span>   <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">secondary</span>.<span class="ruby-identifier">names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
<span class="line-num">567</span>     <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;sorting secondary (#{x})...\n&quot;</span>
<span class="line-num">568</span>     <span class="ruby-identifier">sfiles</span>[<span class="ruby-identifier">x</span>].<span class="ruby-identifier">close</span>(<span class="ruby-keyword">false</span>)
<span class="line-num">569</span>     <span class="ruby-identifier">db</span>.<span class="ruby-identifier">secondary</span>[<span class="ruby-identifier">x</span>].<span class="ruby-identifier">file</span>.<span class="ruby-identifier">import_tsv_files</span>(<span class="ruby-keyword">false</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">sort_proc</span>,
<span class="line-num">570</span>                                           <span class="ruby-identifier">sfiles</span>[<span class="ruby-identifier">x</span>].<span class="ruby-identifier">path</span>)
<span class="line-num">571</span>     <span class="ruby-identifier">sfiles</span>[<span class="ruby-identifier">x</span>].<span class="ruby-identifier">close</span>(<span class="ruby-keyword">true</span>)
<span class="line-num">572</span>   <span class="ruby-keyword">end</span>
<span class="line-num">573</span>   <span class="ruby-keyword">true</span>
<span class="line-num">574</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-c-chose_sort_proc" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-chose_sort_proc" title="Link to this method">
                <span class="method-name">chose_sort_proc</span>
                <span class="method-args">(prog, mode = :new, env = nil, env_args = nil)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="chose_sort_proc-source">
            <pre>    <span class="ruby-comment"># File lib/bio/io/flatfile/indexer.rb</span>
<span class="line-num">585</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">chose_sort_proc</span>(<span class="ruby-identifier">prog</span>, <span class="ruby-identifier">mode</span> = <span class="ruby-value">:new</span>,
<span class="line-num">586</span>                          <span class="ruby-identifier">env</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">env_args</span> = <span class="ruby-keyword">nil</span>)
<span class="line-num">587</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">prog</span>
<span class="line-num">588</span>   <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^builtin$/i</span>, <span class="ruby-regexp">/^hs$/i</span>, <span class="ruby-regexp">/^lm$/i</span>
<span class="line-num">589</span>     <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;sort: internal sort routine\n&quot;</span>
<span class="line-num">590</span>     <span class="ruby-identifier">sort_proc</span> = <span class="ruby-constant">Flat_1</span><span class="ruby-operator">::</span><span class="ruby-constant">FlatMappingFile</span><span class="ruby-operator">::</span><span class="ruby-identifier">internal_sort_proc</span>
<span class="line-num">591</span>   <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">&#39;&#39;</span>
<span class="line-num">592</span>     <span class="ruby-keyword">if</span> <span class="ruby-constant">FileTest</span>.<span class="ruby-identifier">executable?</span>(<span class="ruby-constant">DEFAULT_SORT</span>)
<span class="line-num">593</span>       <span class="ruby-keyword">return</span> <span class="ruby-identifier">chose_sort_proc</span>(<span class="ruby-constant">DEFAULT_SORT</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">env</span>, <span class="ruby-identifier">env_args</span>)
<span class="line-num">594</span>     <span class="ruby-keyword">else</span>
<span class="line-num">595</span>       <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;sort: internal sort routine\n&quot;</span>
<span class="line-num">596</span>       <span class="ruby-identifier">sort_proc</span> = <span class="ruby-constant">Flat_1</span><span class="ruby-operator">::</span><span class="ruby-constant">FlatMappingFile</span><span class="ruby-operator">::</span><span class="ruby-identifier">internal_sort_proc</span>
<span class="line-num">597</span>     <span class="ruby-keyword">end</span>
<span class="line-num">598</span>   <span class="ruby-keyword">else</span>
<span class="line-num">599</span>     <span class="ruby-identifier">env_args</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DEFAULT_ENV_ARGS</span>
<span class="line-num">600</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">env</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># inhibit to use env program</span>
<span class="line-num">601</span>       <span class="ruby-identifier">prefixes</span> = [ <span class="ruby-identifier">prog</span> ]
<span class="line-num">602</span>     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">env</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># uses given env program</span>
<span class="line-num">603</span>       <span class="ruby-identifier">prefixes</span> = [ <span class="ruby-identifier">env</span> ] <span class="ruby-operator">+</span> <span class="ruby-identifier">env_args</span> <span class="ruby-operator">+</span> [ <span class="ruby-identifier">prog</span> ]
<span class="line-num">604</span>     <span class="ruby-keyword">else</span> <span class="ruby-comment"># env == nil; uses default env program if possible</span>
<span class="line-num">605</span>       <span class="ruby-keyword">if</span> <span class="ruby-constant">FileTest</span>.<span class="ruby-identifier">executable?</span>(<span class="ruby-constant">DEFAULT_ENV</span>)
<span class="line-num">606</span>         <span class="ruby-identifier">prefixes</span> = [ <span class="ruby-constant">DEFAULT_ENV</span> ] <span class="ruby-operator">+</span> <span class="ruby-identifier">env_args</span> <span class="ruby-operator">+</span> [ <span class="ruby-identifier">prog</span> ]
<span class="line-num">607</span>       <span class="ruby-keyword">else</span>
<span class="line-num">608</span>         <span class="ruby-identifier">prefixes</span> = [ <span class="ruby-identifier">prog</span> ]
<span class="line-num">609</span>       <span class="ruby-keyword">end</span>
<span class="line-num">610</span>     <span class="ruby-keyword">end</span>
<span class="line-num">611</span>     <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;sort: #{prefixes.join(&#39; &#39;)}\n&quot;</span>
<span class="line-num">612</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">mode</span> <span class="ruby-operator">==</span> <span class="ruby-value">:new</span> <span class="ruby-keyword">then</span>
<span class="line-num">613</span>       <span class="ruby-identifier">sort_proc</span> = <span class="ruby-constant">Flat_1</span><span class="ruby-operator">::</span><span class="ruby-constant">FlatMappingFile</span><span class="ruby-operator">::</span><span class="ruby-identifier">external_sort_proc</span>(<span class="ruby-identifier">prefixes</span>)
<span class="line-num">614</span>     <span class="ruby-keyword">else</span>
<span class="line-num">615</span>       <span class="ruby-identifier">sort_proc</span> = <span class="ruby-constant">Flat_1</span><span class="ruby-operator">::</span><span class="ruby-constant">FlatMappingFile</span><span class="ruby-operator">::</span><span class="ruby-identifier">external_merge_sort_proc</span>(<span class="ruby-identifier">prefixes</span>)
<span class="line-num">616</span>     <span class="ruby-keyword">end</span>
<span class="line-num">617</span>   <span class="ruby-keyword">end</span>
<span class="line-num">618</span>   <span class="ruby-identifier">sort_proc</span>
<span class="line-num">619</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-c-makeindexBDB" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-makeindexBDB" title="Link to this method">
                <span class="method-name">makeindexBDB</span>
                <span class="method-args">(name, parser, options, *files)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="makeindexBDB-source">
            <pre>    <span class="ruby-comment"># File lib/bio/io/flatfile/indexer.rb</span>
<span class="line-num">451</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">makeindexBDB</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
<span class="line-num">452</span>   <span class="ruby-comment"># options are not used in this method</span>
<span class="line-num">453</span>   <span class="ruby-keyword">unless</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">BDB</span>)
<span class="line-num">454</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">RuntimeError</span>, <span class="ruby-string">&quot;Berkeley DB support not found&quot;</span>
<span class="line-num">455</span>   <span class="ruby-keyword">end</span>
<span class="line-num">456</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;makeing BDB DataBank...\n&quot;</span>
<span class="line-num">457</span>   <span class="ruby-identifier">db</span> = <span class="ruby-constant">DataBank</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">name</span>, <span class="ruby-constant">MAGIC_BDB</span>)
<span class="line-num">458</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">format</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">format</span>
<span class="line-num">459</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">add</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
<span class="line-num">460</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">recalc</span>
<span class="line-num">461</span> 
<span class="line-num">462</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">primary</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">primary</span>.<span class="ruby-identifier">name</span>
<span class="line-num">463</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">secondary</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">secondary</span>.<span class="ruby-identifier">names</span>
<span class="line-num">464</span> 
<span class="line-num">465</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;writing config.dat, config, fileids ...\n&quot;</span>
<span class="line-num">466</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&#39;wb&#39;</span>, <span class="ruby-constant">BDBdefault</span><span class="ruby-operator">::</span><span class="ruby-identifier">flag_write</span>)
<span class="line-num">467</span> 
<span class="line-num">468</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;reading files...\n&quot;</span>
<span class="line-num">469</span> 
<span class="line-num">470</span>   <span class="ruby-identifier">addindex_bdb</span>(<span class="ruby-identifier">db</span>, <span class="ruby-constant">BDBdefault</span><span class="ruby-operator">::</span><span class="ruby-identifier">flag_write</span>, (<span class="ruby-value">0</span><span class="ruby-operator">...</span>(<span class="ruby-identifier">files</span>.<span class="ruby-identifier">size</span>)),
<span class="line-num">471</span>                <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">472</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">close</span>
<span class="line-num">473</span>   <span class="ruby-keyword">true</span>
<span class="line-num">474</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-c-makeindexFlat" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-makeindexFlat" title="Link to this method">
                <span class="method-name">makeindexFlat</span>
                <span class="method-args">(name, parser, options, *files)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="makeindexFlat-source">
            <pre>    <span class="ruby-comment"># File lib/bio/io/flatfile/indexer.rb</span>
<span class="line-num">508</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">makeindexFlat</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
<span class="line-num">509</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;makeing flat/1 DataBank using temporary files...\n&quot;</span>
<span class="line-num">510</span> 
<span class="line-num">511</span>   <span class="ruby-identifier">db</span> = <span class="ruby-constant">DataBank</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">name</span>, <span class="ruby-keyword">nil</span>)
<span class="line-num">512</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">format</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">format</span>
<span class="line-num">513</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">add</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
<span class="line-num">514</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">primary</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">primary</span>.<span class="ruby-identifier">name</span>
<span class="line-num">515</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">secondary</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">secondary</span>.<span class="ruby-identifier">names</span>
<span class="line-num">516</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">recalc</span>
<span class="line-num">517</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;writing DabaBank...\n&quot;</span>
<span class="line-num">518</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&#39;wb&#39;</span>)
<span class="line-num">519</span> 
<span class="line-num">520</span>   <span class="ruby-identifier">addindex_flat</span>(<span class="ruby-identifier">db</span>, <span class="ruby-value">:new</span>, (<span class="ruby-value">0</span><span class="ruby-operator">...</span>(<span class="ruby-identifier">files</span>.<span class="ruby-identifier">size</span>)), <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">521</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">close</span>
<span class="line-num">522</span>   <span class="ruby-keyword">true</span>
<span class="line-num">523</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-c-update_index" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-update_index" title="Link to this method">
                <span class="method-name">update_index</span>
                <span class="method-args">(name, parser, options, *files)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="update_index-source">
            <pre>    <span class="ruby-comment"># File lib/bio/io/flatfile/indexer.rb</span>
<span class="line-num">621</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">update_index</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
<span class="line-num">622</span>   <span class="ruby-identifier">db</span> = <span class="ruby-constant">DataBank</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">name</span>)
<span class="line-num">623</span> 
<span class="line-num">624</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">parser</span> <span class="ruby-keyword">then</span>
<span class="line-num">625</span>     <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;file format mismatch&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">db</span>.<span class="ruby-identifier">format</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">format</span>
<span class="line-num">626</span>   <span class="ruby-keyword">else</span>
<span class="line-num">627</span> 
<span class="line-num">628</span>     <span class="ruby-keyword">begin</span>
<span class="line-num">629</span>       <span class="ruby-identifier">dbclass_orig</span> =
<span class="line-num">630</span>         <span class="ruby-constant">Bio</span><span class="ruby-operator">::</span><span class="ruby-constant">FlatFile</span>.<span class="ruby-identifier">autodetect_file</span>(<span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">filename</span>)
<span class="line-num">631</span>     <span class="ruby-keyword">rescue</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
<span class="line-num">632</span>     <span class="ruby-keyword">end</span>
<span class="line-num">633</span>     <span class="ruby-keyword">begin</span>
<span class="line-num">634</span>       <span class="ruby-identifier">dbclass_new</span> =
<span class="line-num">635</span>         <span class="ruby-constant">Bio</span><span class="ruby-operator">::</span><span class="ruby-constant">FlatFile</span>.<span class="ruby-identifier">autodetect_file</span>(<span class="ruby-identifier">files</span>[<span class="ruby-value">0</span>])
<span class="line-num">636</span>     <span class="ruby-keyword">rescue</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
<span class="line-num">637</span>     <span class="ruby-keyword">end</span>
<span class="line-num">638</span> 
<span class="line-num">639</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">db</span>.<span class="ruby-identifier">format</span>
<span class="line-num">640</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;swiss&#39;</span>, <span class="ruby-string">&#39;embl&#39;</span>
<span class="line-num">641</span>       <span class="ruby-identifier">parser</span> = <span class="ruby-constant">Parser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">db</span>.<span class="ruby-identifier">format</span>)
<span class="line-num">642</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">dbclass_new</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">dbclass_new</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">dbclass</span>
<span class="line-num">643</span>         <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;file format mismatch&#39;</span>
<span class="line-num">644</span>       <span class="ruby-keyword">end</span>
<span class="line-num">645</span>     <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;genbank&#39;</span>
<span class="line-num">646</span>       <span class="ruby-identifier">dbclass</span> = <span class="ruby-identifier">dbclass_orig</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">dbclass_new</span>
<span class="line-num">647</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">dbclass</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Bio</span><span class="ruby-operator">::</span><span class="ruby-constant">GenBank</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">dbclass</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Bio</span><span class="ruby-operator">::</span><span class="ruby-constant">GenPept</span>
<span class="line-num">648</span>         <span class="ruby-identifier">parser</span> = <span class="ruby-constant">Parser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">dbclass_orig</span>)
<span class="line-num">649</span>       <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">dbclass</span> <span class="ruby-keyword">then</span>
<span class="line-num">650</span>         <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;cannnot determine format. please specify manually.&#39;</span>
<span class="line-num">651</span>       <span class="ruby-keyword">else</span>
<span class="line-num">652</span>         <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;file format mismatch&#39;</span>
<span class="line-num">653</span>       <span class="ruby-keyword">end</span>
<span class="line-num">654</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">dbclass_new</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">dbclass_new</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">dbclass</span>
<span class="line-num">655</span>         <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;file format mismatch&#39;</span>
<span class="line-num">656</span>       <span class="ruby-keyword">end</span>
<span class="line-num">657</span>     <span class="ruby-keyword">else</span>
<span class="line-num">658</span>       <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;unsupported format&#39;</span>
<span class="line-num">659</span>     <span class="ruby-keyword">end</span>
<span class="line-num">660</span>   <span class="ruby-keyword">end</span>
<span class="line-num">661</span> 
<span class="line-num">662</span>   <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">set_primary_namespace</span>(<span class="ruby-identifier">db</span>.<span class="ruby-identifier">primary</span>.<span class="ruby-identifier">name</span>)
<span class="line-num">663</span>   <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">add_secondary_namespaces</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">db</span>.<span class="ruby-identifier">secondary</span>.<span class="ruby-identifier">names</span>)
<span class="line-num">664</span> 
<span class="line-num">665</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-string">&#39;renew&#39;</span>] <span class="ruby-keyword">then</span>
<span class="line-num">666</span>     <span class="ruby-identifier">newfiles</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">filenames</span>.<span class="ruby-identifier">find_all</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
<span class="line-num">667</span>       <span class="ruby-constant">FileTest</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">x</span>)
<span class="line-num">668</span>     <span class="ruby-keyword">end</span>
<span class="line-num">669</span>     <span class="ruby-identifier">newfiles</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">files</span>)
<span class="line-num">670</span>     <span class="ruby-identifier">newfiles2</span> = <span class="ruby-identifier">newfiles</span>.<span class="ruby-identifier">sort</span>
<span class="line-num">671</span>     <span class="ruby-identifier">newfiles2</span>.<span class="ruby-identifier">uniq!</span>
<span class="line-num">672</span>     <span class="ruby-identifier">newfiles3</span> = []
<span class="line-num">673</span>     <span class="ruby-identifier">newfiles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
<span class="line-num">674</span>       <span class="ruby-identifier">newfiles3</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">x</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">newfiles2</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">x</span>)
<span class="line-num">675</span>     <span class="ruby-keyword">end</span>
<span class="line-num">676</span>     <span class="ruby-identifier">t</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">index_type</span>
<span class="line-num">677</span>     <span class="ruby-identifier">db</span>.<span class="ruby-identifier">close</span>
<span class="line-num">678</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">t</span>
<span class="line-num">679</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">MAGIC_BDB</span>
<span class="line-num">680</span>       <span class="ruby-constant">Indexer</span><span class="ruby-operator">::</span><span class="ruby-identifier">makeindexBDB</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">newfiles3</span>)
<span class="line-num">681</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">MAGIC_FLAT</span>
<span class="line-num">682</span>       <span class="ruby-constant">Indexer</span><span class="ruby-operator">::</span><span class="ruby-identifier">makeindexFlat</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">newfiles3</span>)
<span class="line-num">683</span>     <span class="ruby-keyword">else</span>
<span class="line-num">684</span>       <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;Unsupported index type&#39;</span>
<span class="line-num">685</span>     <span class="ruby-keyword">end</span>
<span class="line-num">686</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="line-num">687</span>   <span class="ruby-keyword">end</span>
<span class="line-num">688</span> 
<span class="line-num">689</span>   <span class="ruby-identifier">need_update</span> = []
<span class="line-num">690</span>   <span class="ruby-identifier">newfiles</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">dup</span>
<span class="line-num">691</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">cache_all</span>
<span class="line-num">692</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
<span class="line-num">693</span>     <span class="ruby-identifier">need_update</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">check</span>
<span class="line-num">694</span>     <span class="ruby-identifier">newfiles</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">filename</span>)
<span class="line-num">695</span>   <span class="ruby-keyword">end</span>
<span class="line-num">696</span> 
<span class="line-num">697</span>   <span class="ruby-identifier">b</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">size</span>
<span class="line-num">698</span>   <span class="ruby-keyword">begin</span>
<span class="line-num">699</span>     <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">recalc</span>
<span class="line-num">700</span>   <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">evar</span>
<span class="line-num">701</span>     <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;Error: #{evar}\n&quot;</span>
<span class="line-num">702</span>     <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;assumed --renew option\n&quot;</span>
<span class="line-num">703</span>     <span class="ruby-identifier">db</span>.<span class="ruby-identifier">close</span>
<span class="line-num">704</span>     <span class="ruby-identifier">options</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>
<span class="line-num">705</span>     <span class="ruby-identifier">options</span>[<span class="ruby-string">&#39;renew&#39;</span>] = <span class="ruby-keyword">true</span>
<span class="line-num">706</span>     <span class="ruby-identifier">update_index</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
<span class="line-num">707</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="line-num">708</span>   <span class="ruby-keyword">end</span>
<span class="line-num">709</span>   <span class="ruby-comment"># add new files</span>
<span class="line-num">710</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">add</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">newfiles</span>)
<span class="line-num">711</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">fileids</span>.<span class="ruby-identifier">recalc</span>
<span class="line-num">712</span> 
<span class="line-num">713</span>   <span class="ruby-identifier">need_update</span>.<span class="ruby-identifier">concat</span>((<span class="ruby-identifier">b</span><span class="ruby-operator">...</span>(<span class="ruby-identifier">b</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">newfiles</span>.<span class="ruby-identifier">size</span>)).<span class="ruby-identifier">to_a</span>)
<span class="line-num">714</span> 
<span class="line-num">715</span>   <span class="ruby-constant">DEBUG</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;writing DabaBank...\n&quot;</span>
<span class="line-num">716</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&#39;wb&#39;</span>, <span class="ruby-constant">BDBdefault</span><span class="ruby-operator">::</span><span class="ruby-identifier">flag_append</span>)
<span class="line-num">717</span> 
<span class="line-num">718</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">db</span>.<span class="ruby-identifier">index_type</span>
<span class="line-num">719</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">MAGIC_BDB</span>
<span class="line-num">720</span>     <span class="ruby-identifier">addindex_bdb</span>(<span class="ruby-identifier">db</span>, <span class="ruby-constant">BDBdefault</span><span class="ruby-operator">::</span><span class="ruby-identifier">flag_append</span>,
<span class="line-num">721</span>                  <span class="ruby-identifier">need_update</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">722</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">MAGIC_FLAT</span>
<span class="line-num">723</span>     <span class="ruby-identifier">addindex_flat</span>(<span class="ruby-identifier">db</span>, <span class="ruby-value">:add</span>, <span class="ruby-identifier">need_update</span>, <span class="ruby-identifier">parser</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">724</span>   <span class="ruby-keyword">else</span>
<span class="line-num">725</span>     <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;Unsupported index type&#39;</span>
<span class="line-num">726</span>   <span class="ruby-keyword">end</span>
<span class="line-num">727</span> 
<span class="line-num">728</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">close</span>
<span class="line-num">729</span>   <span class="ruby-keyword">true</span>
<span class="line-num">730</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

    </section>

  </section>
</main>

